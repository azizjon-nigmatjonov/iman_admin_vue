(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0de1cd"],{"83ea":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("a-navigation",{attrs:{list:[{name:t.$t("Список инвесторов"),link:""}],isBack:{flag:!1,link:"/category/list"},noBorder:""}},[s("div",{staticStyle:{float:"right"}},[s("a-form-model",{ref:"ruleForm",attrs:{layout:"inline"}},["new"===t.type?s("a-form-model-item",{attrs:{label:t.$t("Есть инвестиции ?  ")}},[s("a-switch",{on:{change:t.onChangeSwitch},model:{value:t.investmentStatus,callback:function(e){t.investmentStatus=e},expression:"investmentStatus"}})],1):t._e(),s("a-form-model-item",{attrs:{label:t.$t("search"),prop:"search_args"}},[s("a-input",{on:{change:t.onPhoneChange},model:{value:t.search_args,callback:function(e){t.search_args=e},expression:"search_args"}})],1)],1)],1)]),s("a-card",{staticClass:"no-border-card"},[s("template",{slot:"extra"},[s("a-form-model",{ref:"ruleForm2",attrs:{model:t.form,layout:"inline",rules:t.rules}},[s("a-form-model-item",{attrs:{prop:"date"}},[s("a-range-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD","show-time":{hideDisabledOptions:!1}},on:{change:t.filterDate},model:{value:t.form.date,callback:function(e){t.$set(t.form,"date",e)},expression:"form.date"}})],1),s("a-form-model-item",[s("a-button",{staticStyle:{float:"right",margin:"3px"},attrs:{type:"primary",loading:t.downloading,icon:"file-excel"},on:{click:function(e){return t.download(e,"default")}}},[t._v(t._s(t.$t("Export to excel")))])],1)],1)],1)],2),s("a-card",{staticClass:"no-space-tab"},[s("a-tabs",{attrs:{activeKey:t.type},on:{change:t.onTabChange}},[t._l(t.typeList,(function(e){return s("a-tab-pane",{key:e,attrs:{tab:t.$t(e)}},[s("a-card",[s("a-table",{attrs:{columns:t.columns,"data-source":t.investors,"row-key":function(t){return t.id},pagination:t.pagination,loading:t.loading,bordered:""},on:{change:t.getPagination},scopedSlots:t._u([{key:"index",fn:function(e,a,n){return s("span",{},[t._v(" "+t._s(10*(t.pagination.current-1)+n+1)+" ")])}},{key:"residency",fn:function(e){return s("span",{},[t._v(" "+t._s(e?"Резидент":"Нерезидент")+" ")])}},{key:"created_at",fn:function(e){return s("span",{},[t._v(" "+t._s(t._f("moment")(e.created_at,t.$dateTimeFormat))+" ")])}},{key:"fullname",fn:function(e,a){return s("span",{},[t._v(" "+t._s((a.passport_data&&a.passport_data.first_name||"")+" "+(a.passport_data&&a.passport_data.last_name||""))+" ")])}},{key:"birth_day",fn:function(e){return s("span",{},[t._v(" "+t._s(t._f("moment")(e.birth_day,t.$dateTimeFormat))+" ")])}},{key:"status",fn:function(e){return s("span",{},[s("a-tag",{attrs:{color:t.getStatusColor(e.status)}},[t._v(t._s(t.$t(e.status)))])],1)}},{key:"balance",fn:function(e){return s("span",{},[s("span",[t._v(t._s(t.$moneyFormat(e.balance)))])])}},{key:"invest_sum",fn:function(e){return s("span",{},[s("span",[t._v(t._s(t.$moneyFormat(e.invest_sum)))])])}},{key:"actions",fn:function(e){return s("span",{},[s("delete-btn",{on:{confirm:function(s){return t.deleteInvestor(e)}}})],1)}}],null,!0)})],1)],1)})),s("a-tab-pane",{key:"changeRequests",attrs:{tab:t.$t("changeRequests")}},[s("change-requests-tab")],1)],2)],1)],1)},n=[],r=s("5530"),i=(s("ac1f"),s("d3b7"),s("159b"),s("b047")),o=s.n(i),c=s("c1df"),u=s.n(c),l=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("a-card",[s("a-table",{attrs:{columns:t.columns,"data-source":t.tableData,"row-ley":function(t){return t.investor_id},pagination:!1,loading:t.loading,bordered:""},scopedSlots:t._u([{key:"index",fn:function(e,a,n){return s("span",{},[t._v(" "+t._s(n+1)+" ")])}},{key:"fio",fn:function(e){return s("span",{},[t._v(" "+t._s(e.first_name+" "+e.last_name+" "+e.patronymic)+" ")])}}])})],1)},h=[],d={data:function(){return{tableData:null,loader:!1,columns:[{title:"No",key:"index",scopedSlots:{customRender:"index"},width:"60px",align:"center",customCell:this.onRowClick},{title:"FIO",scopedSlots:{customRender:"fio"},key:"fio",align:"left",customCell:this.onRowClick}]}},mounted:function(){this.getTableData()},watch:{tableData:function(t){}},methods:{getTableData:function(){var t=this;this.loader=!0,this.$store.dispatch("getInvestorEditedList").then((function(e){t.tableData=e.edited_list})).finally((function(){t.loader=!1}))},onRowClick:function(t,e){var s=this;return{on:{click:function(e){s.$router.push({name:"invetstors-edit-preview",params:{id:t.investor_id}})}}}}}},p=d,m=s("2877"),f=Object(m["a"])(p,l,h,!1,null,null,null),g=f.exports,v=s("5880"),_={components:{ChangeRequestsTab:g},created:function(){var t=null;this.$isEmptyObj(this.$route.query)?t={limit:10,page:1,status:""}:(t=this.$route.query,this.type=t.status||"all",t.status="all"===this.type?"":this.type,t.have_investment="new"===this.type?this.investmentStatus:void 0,this.pagination.current=parseInt(this.$route.query.page),this.search_args=this.$route.query.search_args,this.form.date=this.$route.query.start_date?[u()(this.$route.query.start_date),u()(this.$route.query.end_date)]:[]);var e=Object(r["a"])(Object(r["a"])({},t),{},{have_investment:"new"===this.type?this.investmentStatus:void 0});this.getInvestors(e)},data:function(){var t=this;this.onPhoneChange=o()(this.onPhoneChange,700);var e=function(e,s,a){/^[+][9][9][8]\d{9}$/.test(s)?a():a(new Error(t.$t("incorrectPhone")))};return{downloading:!1,downloadingCGU:!1,search_args:"",investmentStatus:!1,form:{phone:""},rules:{phone:[{validator:e,trigger:"change"}],date:[{required:!0,message:"Пожалуйста, введите дату",trigger:"change"}]},type:"all",typeList:["all","in_process","passport","new","cancelled","confirmed","current","left"],investors:[],visible:!1,loading:!1,passport_data:{},selectedInvestors:null,pagination:{current:1,showQuickJumper:!0},columns:[{title:"№",key:"index",scopedSlots:{customRender:"index"},customCell:this.onRowClick},{title:this.$t("Created_at"),scopedSlots:{customRender:"created_at"},key:"created_at",customCell:this.onRowClick},{title:this.$t("fullname"),key:"fullname",scopedSlots:{customRender:"fullname"},customCell:this.onRowClick},{title:this.$t("investors.table.phone_number"),dataIndex:"phone_number",key:"phone_number",customCell:this.onRowClick},{title:this.$t("residency"),dataIndex:"is_resident",scopedSlots:{customRender:"residency"},customCell:this.onRowClick},{title:this.$t("Status"),scopedSlots:{customRender:"status"},key:"status",customCell:this.onRowClick},{title:this.$t("Инвестиции"),scopedSlots:{customRender:"balance"},key:"balance"},{title:this.$t("Прибыль за квартал"),scopedSlots:{customRender:"invest_sum"},width:140,key:"invest_sum"}]}},computed:Object(r["a"])({},Object(v["mapGetters"])(["investmentStatus"])),methods:{downloadEXP:function(){},download:function(t,e){var s=this;t.preventDefault(),this.$refs.ruleForm2.validate((function(t,a){if(t){"cgu"!==e?s.downloading=!0:s.downloadingCGU=!0;var n=s.form.date[0].format("YYYY-MM-DD"),r=s.form.date[1].format("YYYY-MM-DD"),i={begin_date:n,end_date:r};s.$store.dispatch("cgu"===e?"getInvestorCguReport":"getInvestorReports",i).then((function(t){t.filename&&t.filename.length&&t.filename.forEach((function(t,e){window.open(t)}))})).catch((function(t){s.$message.error(t.response.data.error)})).finally((function(){"cgu"!==e?s.downloading=!1:s.downloadingCGU=!1}))}}))},onPhoneChange:function(t){this.$router.push({query:{status:this.type,page:1,search_args:this.search_args}}),this.getInvestors(Object(r["a"])(Object(r["a"])({},this.$route.query),{},{status:"all"===this.type?"":this.type,search_args:this.search_args})),this.pagination.current=1},filterDate:function(t){this.$router.push({query:Object(r["a"])(Object(r["a"])({},this.$route.query),{},{page:1,start_date:t.length?this.form.date[0].format("YYYY-MM-DD"):void 0,end_date:t.length?this.form.date[1].format("YYYY-MM-DD"):void 0})}),this.getInvestors({status:"all"===this.type?"":this.type,search_args:this.search_args,start_date:t.length?this.form.date[0].format("YYYY-MM-DD"):void 0,end_date:t.length?this.form.date[1].format("YYYY-MM-DD"):void 0}),this.pagination.current=1},onChangeSwitch:function(t){this.investmentStatus=t,this.$store.dispatch("hasInvestmentFunction",t),this.getInvestors(Object(r["a"])(Object(r["a"])({},this.$route.query),{},{status:"all"===this.type?"":this.type,search_args:this.search_args,have_investment:t})),this.pagination.current=1},onTabChange:function(t){if(this.type=t,this.$store.dispatch("hasInvestmentFunction",!1),"changeRequests"===t)return this.$router.push({query:{status:this.type}});this.form.phone="",this.$router.push({query:Object(r["a"])(Object(r["a"])({},this.$route.query),{},{status:this.type,page:1,search_args:this.search_args})}),this.getInvestors(Object(r["a"])(Object(r["a"])({},this.$route.query),{},{status:"all"===this.type?"":this.type,search_args:this.search_args,have_investment:"new"===this.type?this.investmentStatus:void 0})),this.pagination.current=1},onRowClick:function(t,e){var s=this;return{on:{click:function(e){s.$router.push({name:"invetstors-preview",params:{id:t.id}})}}}},getStatusColor:function(t){var e;switch(t){case"new":e="cyan";break;case"in_process":e="orange";break;case"current":e="blue";break;case"left":e="red";break;case"confirmed":e="green";break;case"passport":e="purple";break;default:e=""}return e},getPagination:function(t){var e=Object(r["a"])(Object(r["a"])({},this.$route.query),{},{page:t.current,limit:10,status:"all"===this.type?"":this.type,search_args:this.search_args,have_investment:"new"===this.type?this.investmentStatus:void 0});this.$router.push({query:{status:this.type,page:t.current,search_args:this.search_args}}),this.getInvestors(e),this.pagination.current=t.current},getInvestors:function(t){var e=this;this.loading=!0,this.$store.dispatch("getInvestors",t).then((function(t){e.investors=t.investors;var s=Object(r["a"])({},e.pagination);s.total=+t.count,e.pagination=s,e.loading=!1})).catch((function(t){e.$alertMessage(t.response.data.message),e.loading=!1}))},deleteInvestor:function(t){var e=this;this.$store.dispatch("deleteInvestor",t.id).then((function(s){e.$deleteFromList(e.investors,t.id),e.$alertMessage("success","Deleted","Investor has deleted successfully",e)})).catch((function(t){t.response.data&&e.$alertMessage(t.response.data.message)})).finally((function(){e.getInvestors(Object(r["a"])(Object(r["a"])({},e.$route.query),{},{status:"all"===e.type?"":e.type,search_args:e.search_args}))}))}}},y=_,b=Object(m["a"])(y,a,n,!1,null,null,null);e["default"]=b.exports}}]);