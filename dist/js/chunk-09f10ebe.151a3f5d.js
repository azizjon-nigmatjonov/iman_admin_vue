(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-09f10ebe"],{"15fd":function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));i("a4d3"),i("b64b");function a(e,t){if(null==e)return{};var i,a,r={},n=Object.keys(e);for(a=0;a<n.length;a++)i=n[a],t.indexOf(i)>=0||(r[i]=e[i]);return r}function r(e,t){if(null==e)return{};var i,r,n=a(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)i=o[r],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}},a0fd:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("a-navigation",{attrs:{list:[{name:e.$t("Stories"),link:""}],isBack:{flag:!1},noBorder:""}}),i("a-card",{staticClass:"no-border-card no-pt-body-card"},[i("a-form-model",{ref:"ruleForm",attrs:{colon:!1,model:e.form,rules:e.rules}},[i("a-row",{staticClass:"form-row",attrs:{gutter:16}},[i("a-col",{attrs:{span:8}},[i("a-form-model-item",{ref:"title.en",attrs:{label:e.$t("title_en"),prop:"title.en"}},[i("a-textarea",{attrs:{placeholder:e.$t("message_en"),disabled:e.disable},model:{value:e.form.title.en,callback:function(t){e.$set(e.form.title,"en",t)},expression:"form.title.en"}})],1)],1),i("a-col",{attrs:{span:8}},[i("a-form-model-item",{ref:"title.ru",attrs:{label:e.$t("title_ru"),prop:"title.ru"}},[i("a-textarea",{attrs:{placeholder:e.$t("message_ru"),disabled:e.disable},model:{value:e.form.title.ru,callback:function(t){e.$set(e.form.title,"ru",t)},expression:"form.title.ru"}})],1)],1),i("a-col",{attrs:{span:8}},[i("a-form-model-item",{ref:"title.uz",attrs:{label:e.$t("title_uz"),prop:"title.uz"}},[i("a-textarea",{attrs:{placeholder:e.$t("message_uz"),disabled:e.disable},model:{value:e.form.title.uz,callback:function(t){e.$set(e.form.title,"uz",t)},expression:"form.title.uz"}})],1)],1),i("a-col",{staticStyle:{padding:"0 15px"},attrs:{xs:24}},[i("a-form-model-item",{ref:"media",attrs:{label:e.$t("media file"),prop:"media"}},[i("a-upload",{attrs:{accept:"video/*, image/*",name:"file",customRequest:e.uploadFile,multiple:!0,"file-list":e.form.media,"list-type":"text",remove:e.onRemoveClick,beforeUpload:e.onBeforeUpload},on:{change:e.handleChangeFile}},[i("a-button",[i("a-icon",{attrs:{type:e.uploadingFile?"loading":"upload"}}),e._v(" Click to Upload ")],1)],1),e._l(e.filteredVIdeos,(function(t){return i("my-video-player",{key:t.uid,attrs:{width:"100%",src:t,controls:""}},[e._v(" unreadable format by your browser ")])}))],2)],1),i("a-col",{staticStyle:{padding:"0 15px"},attrs:{xs:24}},[i("a-upload",{attrs:{name:"photo","file-list":e.filteredPhotos,"list-type":"picture-card",showUploadList:{showRemoveIcon:!1},remove:e.onRemoveClick},on:{preview:e.handlePreview}})],1),i("a-col",{attrs:{span:24}},[i("a-form-model-item",{ref:"thumbnail",attrs:{label:e.$t("thumbnail"),prop:"thumbnail"}},[i("a-upload",{attrs:{accept:"image/*",customRequest:e.uploadImage,"list-type":"picture-card","file-list":e.fileList,remove:e.onRemoveThumbnailClick},on:{preview:e.handlePreview,change:e.handleChange}},[e.fileList.length?e._e():i("div",[i("a-icon",{attrs:{type:e.uploadingImage?"loading":"plus"}}),i("div",{staticClass:"ant-upload-text"},[e._v(e._s(e.$t("button.upload")))])],1)]),i("a-modal",{attrs:{visible:e.previewVisible,footer:null},on:{cancel:function(t){e.previewVisible=!1}}},[i("img",{staticStyle:{width:"100%"},attrs:{alt:e.previewImage,src:e.previewImage}})])],1)],1)],1)],1)],1),e.$route.query.id?i("a-row",{staticClass:"edit-btns mt-4"},[i("a-col",{attrs:{span:"24"}},[i("a-form-model-item",[i("a-row",{attrs:{type:"flex",justify:"end"}},[i("a-col",{attrs:{span:"auto"}},[i("a-button",{staticStyle:{width:"unset"},attrs:{loading:e.loading,type:"primary"},on:{click:e.saveStories}},[e._v(e._s(e.$t("save")))])],1)],1)],1)],1)],1):i("a-row",{staticClass:"edit-btns mt-4"},[i("a-col",{attrs:{span:"24"}},[i("a-form-model-item",[i("a-row",{attrs:{type:"flex",justify:"end"}},[i("a-col",{attrs:{span:"auto"}},[i("a-button",{staticStyle:{width:"unset"},attrs:{loading:e.loading,type:"primary"},on:{click:e.sendStories}},[e._v(e._s(e.$t("send stories")))])],1)],1)],1)],1)],1)],1)},r=[],n=i("15fd"),o=i("1da1"),l=i("5530"),s=(i("96cf"),i("4de4"),i("d3b7"),i("fb6a"),i("d81d"),i("ac1f"),i("1276"),i("99af"),i("b0c0"),i("9911"),["files"]),u={data:function(){return{loading:!1,fileList:[],previewImage:"",previewVisible:!1,uploadingImage:!1,uploadingFile:!1,disable:!!this.$route.query.id,form:{media:[],media_type:"",thumbnail:"",title:{en:"",ru:"",uz:""}},mainVideo:{videos:[],photo:"",format:"",videoUrl:"",imageUrlMain:"",uploadedFile:"",displayFilename:"none",movieLoading:!1,loadingMain:!1,percentage:0},rules:{"title.ru":[{required:!0,message:"".concat(this.$t("required")),trigger:"change"}],"title.uz":[{required:!0,message:"".concat(this.$t("required")),trigger:"change"}],"title.en":[{required:!0,message:"".concat(this.$t("required")),trigger:"change"}],media:[{required:!0,message:"".concat(this.$t("required")),trigger:"change"}],thumbnail:[{required:!0,message:"".concat(this.$t("required")),trigger:"change"}]}}},mounted:function(){this.$route.query&&this.$route.query.id&&this.getStoriesDetail()},computed:{filteredVIdeos:function(){return this.form.media.filter((function(e){return"video"===e.media_type}))},filteredPhotos:function(){return this.form.media.filter((function(e){return"photo"===e.media_type}))}},methods:{onBeforeUpload:function(e,t){this.form.media_type="image"===e.type.slice(0,5)?"photo":"video"},saveStories:function(){var e=this;this.loading=!0;var t=Object(l["a"])(Object(l["a"])({},this.form),{},{guid:this.$route.query.id,media:this.form.media.map((function(e){return{link:e.url.split("/").pop(),media_type:e.media_type}})),thumbnail:this.form.thumbnail.split("/").pop()});delete t.title,delete t.media_type,this.$store.dispatch("patchStories",t).then((function(t){e.$router.go(-1)})).finally((function(){e.loading=!1}))},onRemoveClick:function(e){this.form.media=this.form.media.filter((function(t){return e.uid!==t.uid}))},onRemoveThumbnailClick:function(e){this.fileList=[]},uploadFile:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function i(){var a;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:t.uploadingFile=!0,a=new FormData,a.append("file",e.file),t.$store.dispatch("upload",a).then((function(i){t.form.media.push({uid:i.filename,name:i.filename,status:"done",url:"".concat("https://cdn.iman.uz/iman","/").concat(i.filename),type:e.file.type,media_type:t.form.media_type})})).catch((function(e){})).finally((function(){t.uploadingFile=!1}));case 4:case"end":return i.stop()}}),i)})))()},handleChangeFile:function(e){e.file.status,"done"===e.file.status?this.$message.success("".concat(e.file.name," file uploaded successfully")):"error"===e.file.status&&this.$message.error("".concat(e.file.name," file upload failed."))},uploadImage:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function i(){var a,r;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return t.uploadingImage=!0,a=new FormData,a.append("file",e.file),i.next=5,t.$getBase64(e.file);case 5:r=i.sent,t.$store.dispatch("upload",a).then((function(e){t.fileList[0]={uid:e.filename,name:e.filename,status:"done",url:r},t.form.thumbnail=e.filename})).catch((function(e){})).finally((function(){t.uploadingImage=!1}));case 7:case"end":return i.stop()}}),i)})))()},handleChange:function(e){e.fileList;var t=e.file;"uploading"!==t.status&&(this.fileList[0]=t,this.form.thumbnail[0]=t,"done"===t.status&&(this.form.thumbnail[0]=t))},handlePreview:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(e.url||e.preview){i.next=4;break}return i.next=3,t.$getBase64(e.originFileObj);case 3:e.preview=i.sent;case 4:t.previewImage=e.url||e.preview,t.previewVisible=!0;case 6:case"end":return i.stop()}}),i)})))()},getStoriesDetail:function(){var e=this;this.$store.dispatch("getStoriesDetail",this.$route.query.id).then((function(t){e.form.title=t.title,e.form.thumbnail=t.thumbnail,e.fileList=[{uid:t.thumbnail.split("/").pop(),url:t.thumbnail,status:"done",name:t.thumbnail}],e.form.media=t.media.map((function(e){return{uid:e.link.split("/").pop(),url:e.link,status:"done",name:e.link,type:"video/".concat(e.link.split(".").pop()),media_type:e.media_type}}))})).finally((function(){e.loading=!1}))},sendStories:function(){var e=this;if(!this.$isValid(this))return this.$formValidationError("warning","Form required","Please provide all fields",this),-1;var t=this.form,i=(t.files,Object(n["a"])(t,s));i.thumbnail=this.fileList[0].uid,delete i.media_type,i.media=this.form.media.map((function(e){return{link:e.uid,media_type:e.media_type}})),this.$store.dispatch("sendStories",i).then((function(t){e.$alertMessage("success","Message","Message successfully send to investors",e),e.$router.go(-1)})).finally((function(){e.loading=!1}))},cancelPost:function(){this.$router.go(-1)},handleSubmit:function(e){}}},d=u,c=i("2877"),m=Object(c["a"])(d,a,r,!1,null,null,null);t["default"]=m.exports}}]);