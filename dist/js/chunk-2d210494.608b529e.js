(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d210494"],{b6f0:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("a-navigation",{attrs:{list:[{name:e.$t("Cоздание пользователя"),link:"/system/roles"},{name:e.$route.params.id?e.$t("button.edit"):e.$t("Добавить"),link:""}],isBack:{flag:!0,return:!0},noBorder:""}}),s("a-card",{staticClass:"no-border-card no-pt-body-card",attrs:{title:e.$route.params.id?e.$t("button.edit"):"Cоздание пользователя"}},[s("a-form-model",{ref:"ruleForm",attrs:{colon:!1,model:e.form,rules:e.rules}},[s("a-row",{staticClass:"form-row",attrs:{gutter:16}},[s("a-col",{attrs:{span:8}},[s("a-form-model-item",{ref:"name",attrs:{label:e.$t("first_name"),prop:"name"}},[s("a-input",{attrs:{placeholder:"Имя"},on:{blur:function(){e.$refs.name.onFieldBlur()}},model:{value:e.form.first_name,callback:function(t){e.$set(e.form,"first_name",t)},expression:"form.first_name"}})],1)],1),s("a-col",{attrs:{span:8}},[s("a-form-model-item",{ref:"last_name",attrs:{label:e.$t("last_name"),prop:"last_name"}},[s("a-input",{attrs:{placeholder:e.$t("first_name")},on:{blur:function(){e.$refs.name.onFieldBlur()}},model:{value:e.form.last_name,callback:function(t){e.$set(e.form,"last_name",t)},expression:"form.last_name"}})],1)],1),s("a-col",{attrs:{span:8}},[s("a-form-model-item",{ref:"name",attrs:{label:"Телефонный номер",prop:"phone"}},[s("a-input",{attrs:{placeholder:"телефонный номер"},on:{blur:function(){e.$refs.name.onFieldBlur()}},model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1)],1)],1),s("a-row",{attrs:{type:"flex",gutter:[16]}},[s("a-col",{attrs:{span:"8"}},[s("a-form-model-item",{attrs:{label:"Логин",prop:"username"}},[s("a-input",{attrs:{placeholder:"логин"},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1)],1),s("a-col",{attrs:{span:"8"}},[s("a-form-model-item",{attrs:{label:"Пароль",prop:"password"}},[s("a-input-password",{attrs:{type:"password",placeholder:"пароль"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1)],1)],1)],1)],1),s("a-row",{staticClass:"edit-btns mt-4"},[s("a-col",{attrs:{span:"24"}},[s("a-form-model-item",[s("a-row",{attrs:{type:"flex",justify:"end"}},[s("a-col",{attrs:{span:"auto"}},[s("a-button",{staticStyle:{"margin-right":"6px"},attrs:{type:"grey",loading:e.loading},on:{click:e.cancelPost}},[e._v(" "+e._s(e.$t("button.cancel"))+" ")]),e.isNewForm?s("a-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.postSystemUser}},[e._v(" "+e._s(e.$t("button.create"))+" ")]):s("a-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.updateSystemUser}},[e._v(e._s(e.$t("button.save"))+" ")])],1)],1)],1)],1)],1),e.$route.params.id?s("a-card",[s("a-row",[s("h3",[e._v("Выберите роли")]),s("a-col",{attrs:{span:"16"}},[s("a-select",{staticStyle:{"min-width":"250px"},attrs:{mode:"multiple",placeholder:"Select roles"},on:{change:e.handleChange},model:{value:e.selectedRoles,callback:function(t){e.selectedRoles=t},expression:"selectedRoles"}},e._l(e.user_roles,(function(t){return s("a-select-option",{key:t.id},[e._v(" "+e._s(t.name)+" ")])})),1)],1)],1)],1):e._e()],1)},a=[],o=s("1da1"),n=(s("96cf"),s("d81d"),s("d3b7"),s("ac1f"),s("5319"),s("7db0"),s("caad"),s("2532"),{data:function(){return{loading:!1,isNewForm:!1,selectedRoles:[],counter:0,scopes:[],user_with_roles:[],user_roles:[],filteredRoles:[],form:{first_name:"",last_name:"",username:"",password:"",phone:""},rules:{first_name:[{required:!0,message:"Пожалуйста, введите",trigger:"blur"}],last_name:[{required:!0,message:"Пожалуйста, введите",trigger:"blur"}],password:[{required:!0,message:"Пожалуйста, введите password",trigger:"blur"}],username:[{required:!0,message:"Пожалуйста, введите логин",trigger:"blur"}],phone:[{required:!0,message:"Пожалуйста, выберите номер"}]}}},methods:{fetchItems:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var s,r,a,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,e.$store.dispatch("getUserRoles");case 4:return s=t.sent,r=s.user_roles,e.user_roles=r,t.next=9,e.$store.dispatch("getUserWithRoles",e.$route.params.id);case 9:a=t.sent,o=a.user_role,e.user_with_roles=o,e.selectedRoles=o.map((function(e){return e.user_role_id})),t.next=17;break;case 15:t.prev=15,t.t0=t["catch"](1);case 17:return t.prev=17,e.loading=!1,t.finish(17);case 20:case"end":return t.stop()}}),t,null,[[1,15,17,20]])})))()},checkPost:function(){var e=null;return this.$refs.ruleForm.validate((function(t){return t?(e=!0,!0):(e=!1,!1)})),e},postSystemUser:function(){var e=this;if(!1===this.checkPost())return-1;this.loading=!0,this.$store.dispatch("postSystemUser",this.form).then((function(t){e.$alertMessage("success","System-user","System user added successfully",e),e.$router.push("/system/system-users"),e.loading=!1})).catch((function(t){400===t.response.status&&alert(t.response.data.message),e.loading=!1})).finally((function(){e.loading=!1}))},getSystemUser:function(e){var t=this;this.$store.dispatch("getSystemUser",e).then((function(e){t.form=e}))},updateSystemUser:function(){var e=this;if(!1===this.checkPost())return-1;this.loading=!0,this.$store.dispatch("updateSystemUser",this.form).then((function(t){e.$alertMessage("success","System-user","System-user has updated successfully",e),e.$refs.ruleForm.resetFields(),e.$router.push("/system/system-users"),e.loading=!1})).finally((function(){e.loading=!1}))},cancelPost:function(){this.$router.replace("/system/system-users")},getRoles:function(){var e=this;this.$store.dispatch("getUserRoles").then((function(t){e.roles=t.user_roles})).catch((function(e){}))},handleSubmit:function(e){}},created:function(){this.$isEmptyObj(this.$route.params)&&(this.isNewForm=!0),this.$route.params.id&&(this.getSystemUser(this.$route.params.id),this.fetchItems())},watch:{selectedRoles:function(e,t){if(0===this.counter)this.counter+=1;else if(e.length>t.length){var s=e[e.length-1];this.$store.dispatch("postUserWithRole",{user_role_id:s,user_id:this.$route.params.id})}else{var r=t.find((function(t){return!e.includes(t)}));this.$store.dispatch("deleteUserWithRole",{user_id:this.$route.params.id,user_role_id:r})}}}}),l=n,i=s("2877"),u=Object(i["a"])(l,r,a,!1,null,null,null);t["default"]=u.exports}}]);